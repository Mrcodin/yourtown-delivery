const t={BASE_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3000/api":"https://yourtown-delivery-api.onrender.com/api",STRIPE_KEY:"pk_test_your_stripe_publishable_key",SOCKET_URL:"localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname?"http://localhost:3000":"https://yourtown-delivery-api.onrender.com"};class e{constructor(){this.baseURL=t.BASE_URL,this.token=localStorage.getItem("authToken")}getToken(){return localStorage.getItem("authToken")}setToken(t){localStorage.setItem("authToken",t),this.token=t}removeToken(){localStorage.removeItem("authToken"),this.token=null}clearToken(){this.removeToken()}getHeaders(t=!0){const e={"Content-Type":"application/json"};return t&&this.token&&(e.Authorization=`Bearer ${this.token}`),e}async request(t,e={}){const s={...e,headers:{...this.getHeaders(!1!==e.auth),...e.headers}},r=`${t}-${Date.now()}`,n=!1!==e.showLoading,o=!0===e.showOverlay,a=e.loadingMessage||"Loading...";try{"undefined"!=typeof loading&&n&&(loading.startRequest(r),o&&loading.showOverlay(a));const i=await fetch(`${this.baseURL}${t}`,s);let c;const u=i.headers.get("content-type");if(c=u&&u.includes("application/json")?await i.json():{success:i.ok},!i.ok){401===i.status&&!1!==e.auth&&(this.removeToken(),window.location.pathname.includes("admin")&&(window.location.href="/admin-login.html"));const t=new Error(c.message||"Request failed");throw t.status=i.status,t.statusCode=i.status,t.data=c,t}return c}catch(t){throw t.status||t.statusCode||(t.status=0,t.statusCode=0),t}finally{"undefined"!=typeof loading&&n&&(loading.endRequest(r),o&&loading.hideOverlay())}}async get(t,e={}){return this.request(t,{method:"GET",...e})}async post(t,e,s={}){return this.request(t,{method:"POST",body:JSON.stringify(e),...s})}async put(t,e,s={}){return this.request(t,{method:"PUT",body:JSON.stringify(e),...s})}async delete(t,e={}){return this.request(t,{method:"DELETE",...e})}async login(t,e){const s=await this.post("/auth/login",{username:t,password:e},{auth:!1});return s.success&&s.token&&this.setToken(s.token),s}async logout(){const t=await this.post("/auth/logout");return this.removeToken(),t}async verifyToken(){return this.get("/auth/verify")}async refreshToken(){const t=await this.post("/auth/refresh");return t.success&&t.token&&this.setToken(t.token),t}async getProducts(t={}){const e=new URLSearchParams(t);return this.get(`/products?${e}`,{auth:!1})}async getProduct(t){return this.get(`/products/${t}`,{auth:!1})}async createProduct(t){return this.post("/products",t)}async updateProduct(t,e){return this.put(`/products/${t}`,e)}async deleteProduct(t){return this.delete(`/products/${t}`)}async getOrders(t={}){const e=new URLSearchParams(t);return this.get(`/orders?${e}`)}async getOrder(t){return this.get(`/orders/${t}`)}async trackOrder(t){return this.get(`/orders/track/${t}`,{auth:!1})}async createOrder(t){return this.post("/orders",t,{auth:!1})}async updateOrderStatus(t,e){return this.put(`/orders/${t}/status`,{status:e})}async assignDriver(t,e){return this.put(`/orders/${t}/assign-driver`,{driverId:e})}async cancelOrder(t,e){return this.delete(`/orders/${t}`,{body:JSON.stringify({reason:e}),headers:{"Content-Type":"application/json"}})}async getCustomers(t={}){const e=new URLSearchParams(t);return this.get(`/customers?${e}`)}async getCustomer(t){return this.get(`/customers/${t}`)}async getCustomerByPhone(t){return this.get(`/customers/by-phone/${t}`,{auth:!1})}async updateCustomer(t,e){return this.put(`/customers/${t}`,e)}async exportCustomers(){window.open(`${this.baseURL}/customers/export/csv?token=${this.token}`,"_blank")}async getDrivers(t={}){const e=new URLSearchParams(t);return this.get(`/drivers?${e}`)}async getDriver(t){return this.get(`/drivers/${t}`)}async getDriverOrders(t,e={}){const s=new URLSearchParams(e);return this.get(`/drivers/${t}/orders?${s}`)}async createDriver(t){return this.post("/drivers",t)}async updateDriver(t,e){return this.put(`/drivers/${t}`,e)}async updateDriverStatus(t,e){return this.put(`/drivers/${t}/status`,{status:e})}async deleteDriver(t){return this.delete(`/drivers/${t}`)}async getSummary(t={}){const e=new URLSearchParams(t);return this.get(`/reports/summary?${e}`)}async getDailyRevenue(t=7){return this.get(`/reports/daily-revenue?days=${t}`)}async getTopProducts(t={}){const e=new URLSearchParams(t);return this.get(`/reports/top-products?${e}`)}async getDriverPerformance(){return this.get("/reports/driver-performance")}async getCustomerInsights(){return this.get("/reports/customer-insights")}async getActivityLogs(t={}){const e=new URLSearchParams(t);return this.get(`/activity-logs?${e}`)}async createPaymentIntent(t,e){return this.post("/payments/create-intent",{orderId:t,amount:e},{auth:!1})}async confirmPayment(t,e){return this.post("/payments/confirm",{orderId:t,paymentIntentId:e},{auth:!1})}async getPaymentStatus(t){return this.get(`/payments/status/${t}`,{auth:!1})}async createRefund(t,e,s){return this.post("/payments/refund",{paymentIntentId:t,amount:e,reason:s})}}const s=new e;class r{constructor(){this.socket=null,this.connected=!1}connect(){if(!this.socket)if("undefined"==typeof io){const t=document.createElement("script");t.src="https://cdn.socket.io/4.6.1/socket.io.min.js",t.onload=()=>this.initSocket(),document.head.appendChild(t)}else this.initSocket()}initSocket(){this.socket=io(t.SOCKET_URL,{transports:["websocket","polling"]}),this.socket.on("connect",()=>{this.connected=!0}),this.socket.on("disconnect",()=>{this.connected=!1}),this.socket.on("connect_error",t=>{})}joinAdmin(){this.socket&&this.socket.emit("join-admin")}joinDriver(t){this.socket&&this.socket.emit("join-driver",t)}joinTracking(t){this.socket&&this.socket.emit("join-tracking",t)}on(t,e){this.socket&&this.socket.on(t,e)}off(t,e){this.socket&&this.socket.off(t,e)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null,this.connected=!1)}}const n=new r,o={formatCurrency:t=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(t),formatDate:t=>new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),formatDateTime:t=>new Date(t).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit"}),showLoading(t){"string"==typeof t&&(t=document.querySelector(t)),t&&(t.innerHTML='<div class="spinner">Loading...</div>')},showError(t,e){"string"==typeof e&&(e=document.querySelector(e)),e?e.innerHTML=`<div class="error-message">${t}</div>`:alert(t)},showSuccess(t,e){"string"==typeof e&&(e=document.querySelector(e)),e?e.innerHTML=`<div class="success-message">${t}</div>`:alert(t)},debounce(t,e){let s;return function(...r){clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),t(...r)},e)}}};"undefined"!=typeof module&&module.exports&&(module.exports={api:s,socketManager:n,utils:o,API_CONFIG:t});