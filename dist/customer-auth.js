class e{constructor(){this.tokenKey="customerAuthToken",this.customerKey="customerData"}getToken(){return localStorage.getItem(this.tokenKey)}setToken(e){localStorage.setItem(this.tokenKey,e)}removeToken(){localStorage.removeItem(this.tokenKey),localStorage.removeItem(this.customerKey),localStorage.removeItem("emailVerified")}getCustomer(){const e=localStorage.getItem(this.customerKey);return e?JSON.parse(e):null}setCustomer(e){localStorage.setItem(this.customerKey,JSON.stringify(e))}isLoggedIn(){return!!this.getToken()}async register(e,t,o,r){try{const i=await fetch(`${API_CONFIG.BASE_URL}/customer-auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:t,password:o,phone:r})}),s=await i.json();if(!i.ok)throw new Error(s.message||"Registration failed");return this.setToken(s.token),this.setCustomer(s.customer),localStorage.setItem("emailVerified","false"),s}catch(e){throw e}}async login(e,t){try{const o=await fetch(`${API_CONFIG.BASE_URL}/customer-auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:t})}),r=await o.json();if(!o.ok)throw new Error(r.message||"Login failed");return this.setToken(r.token),this.setCustomer(r.customer),void 0!==r.emailVerified&&localStorage.setItem("emailVerified",r.emailVerified.toString()),r}catch(e){throw e}}async logout(){try{const e=this.getToken();e&&await fetch(`${API_CONFIG.BASE_URL}/customer-auth/logout`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}})}catch(e){}finally{this.removeToken(),window.location.href="/index.html"}}async getProfile(){try{const e=this.getToken();if(!e)throw new Error("Not authenticated");const t=await fetch(`${API_CONFIG.BASE_URL}/customer-auth/me`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw new Error(o.message||"Failed to fetch profile");return this.setCustomer(o.customer),void 0!==o.customer.isEmailVerified&&localStorage.setItem("emailVerified",o.customer.isEmailVerified.toString()),o.customer}catch(e){throw e}}async updateProfile(e){try{const t=this.getToken();if(!t)throw new Error("Not authenticated");const o=await fetch(`${API_CONFIG.BASE_URL}/customer-auth/profile`,{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(e)}),r=await o.json();if(!o.ok)throw new Error(r.message||"Failed to update profile");return this.setCustomer(r.customer),r.customer}catch(e){throw e}}async changePassword(e,t){try{const o=this.getToken();if(!o)throw new Error("Not authenticated");const r=await fetch(`${API_CONFIG.BASE_URL}/auth/password`,{method:"PUT",headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e,newPassword:t})}),i=await r.json();if(!r.ok)throw new Error(i.message||"Failed to change password");return i}catch(e){throw e}}async verifyToken(){try{const e=this.getToken();if(!e)return!1;const t=await fetch(`${API_CONFIG.BASE_URL}/customer-auth/verify`,{method:"GET",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!t.ok)return this.removeToken(),!1;const o=await t.json();return this.setCustomer(o.customer),!0}catch(e){return this.removeToken(),!1}}requireAuth(e="/customer-login.html"){return!!this.isLoggedIn()||(sessionStorage.setItem("redirectAfterLogin",window.location.href),window.location.href=e,!1)}getRedirectUrl(){const e=sessionStorage.getItem("redirectAfterLogin");return sessionStorage.removeItem("redirectAfterLogin"),e||"/index.html"}isEmailVerified(){const e=localStorage.getItem("emailVerified");if(null!==e)return"true"===e;const t=this.getCustomer();return!(!t||void 0===t.isEmailVerified)&&(localStorage.setItem("emailVerified",t.isEmailVerified.toString()),t.isEmailVerified)}async resendVerification(){try{const e=this.getToken();if(!e)throw new Error("Not authenticated");const t=await fetch(`${API_CONFIG.BASE_URL}/customer-auth/resend-verification`,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}}),o=await t.json();if(!t.ok)throw new Error(o.message||"Failed to resend verification email");return o}catch(e){throw e}}}const t=new e;