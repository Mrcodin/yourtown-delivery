function e(e=groceries){const t=document.getElementById("grocery-grid"),n=document.getElementById("empty-state"),o=document.getElementById("results-count");if(t){if(0===e.length)return t.style.display="none",void(n&&(n.style.display="block"));t.style.display="grid",n&&(n.style.display="none"),o&&(o.textContent=`Showing ${e.length} item${1!==e.length?"s":""}`),t.innerHTML=e.map(e=>{const t=e.imageUrl?`<img src="${e.imageUrl}" alt="${e.name}" style="width: 100%; height: 100%; object-fit: cover;">`:e.emoji;return`\n        <div class="grocery-item" data-category="${e.category}">\n            <div class="item-image" onclick="openQuickView('${e.id}')" style="cursor: pointer;">${t}</div>\n            <div class="item-content">\n                <h3 class="item-name">${e.name}</h3>\n                <div class="item-price">$${e.price.toFixed(2)}</div>\n                <div style="display: flex; gap: 8px;">\n                    <button class="add-btn" onclick="addToCart('${e.id}')" style="flex: 1;">\n                        Add to Cart\n                    </button>\n                    <button class="btn btn-secondary" onclick="openQuickView('${e.id}')" style="padding: 12px; width: 44px;" title="Quick View">\n                        üëÅÔ∏è\n                    </button>\n                </div>\n            </div>\n        </div>\n        `}).join("")}}function t(){const e=document.getElementById("cart-items"),t=document.getElementById("empty-cart"),o=document.getElementById("order-summary"),i=document.getElementById("cart-actions");if(e){if(0===cart.length)return e.innerHTML="",t&&(t.style.display="block"),o&&(o.style.display="none"),void(i&&(i.style.display="none"));t&&(t.style.display="none"),o&&(o.style.display="block"),i&&(i.style.display="flex"),e.innerHTML=cart.map(e=>`\n        <div class="cart-item">\n            <div class="cart-item-image">${e.imageUrl?`<img src="${e.imageUrl}" alt="${e.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">`:e.emoji}</div>\n            <div class="cart-item-info">\n                <h3 class="cart-item-name">${e.name}</h3>\n                <p class="cart-item-price">$${e.price.toFixed(2)} each</p>\n            </div>\n            <div class="quantity-controls">\n                <button class="qty-btn" onclick="updateQuantity('${e.id}', -1)">‚àí</button>\n                <span class="qty-number">${e.quantity}</span>\n                <button class="qty-btn" onclick="updateQuantity('${e.id}', 1)">+</button>\n            </div>\n            <div class="cart-item-total">$${(e.price*e.quantity).toFixed(2)}</div>\n            <button class="remove-item-btn" onclick="removeFromCart('${e.id}')">√ó</button>\n        </div>\n        `).join(""),n()}}function n(){const e=cart.reduce((e,t)=>e+t.price*t.quantity,0),t=parseFloat(document.getElementById("custom-tip")?.value||0)||0;let n=0;if("function"==typeof getValidatedPromoCode){const e=getValidatedPromoCode();e&&e.discount&&(n=e.discount)}const o=.084*(6.99+cart.reduce((e,t)=>e+(t.isTaxable?t.price*t.quantity:0),0)),i=e+6.99+t+o-n,c=cart.reduce((e,t)=>e+t.quantity,0),a=document.getElementById("summary-item-count"),r=document.getElementById("summary-subtotal"),d=document.getElementById("summary-tax"),s=document.getElementById("summary-total");a&&(a.textContent=c),r&&(r.textContent=e.toFixed(2)),d&&(d.textContent=o.toFixed(2)),s&&(s.textContent=i.toFixed(2))}function o(e,t){document.querySelectorAll(".category-btn").forEach(e=>e.classList.remove("active")),t&&t.classList.add("active"),a()}function i(){a()}function c(){const e=document.getElementById("sort-select")?.value;if(!e)return;let t=[...groceries];switch(e){case"name-asc":t.sort((e,t)=>e.name.localeCompare(t.name));break;case"name-desc":t.sort((e,t)=>t.name.localeCompare(e.name));break;case"price-asc":t.sort((e,t)=>e.price-t.price);break;case"price-desc":t.sort((e,t)=>t.price-e.price)}a(t)}function a(t){try{const n=document.getElementById("search-input")?.value.toLowerCase().trim(),o=document.getElementById("price-filter")?.value||"all",i=(document.getElementById("in-stock-filter"),document.querySelector(".category-btn.active")?.textContent.trim());let c=t||[...groceries];if(i&&!i.includes("All Items")){const e={"ü•¨ Produce":"produce","ü•õ Dairy & Eggs":"dairy","üçû Bakery":"bakery","ü•© Meat":"meat","ü•´ Pantry":"pantry","üßä Frozen":"frozen","ü•§ Beverages":"beverages"}[i];e&&(c=c.filter(t=>t.category===e))}if(n&&(c=c.filter(e=>e.name.toLowerCase().includes(n)||e.category.toLowerCase().includes(n))),"all"!==o){const[e,t]=o.split("-").map(Number);c=c.filter(n=>n.price>=e&&n.price<=t)}e(c)}catch(e){"undefined"!=typeof ErrorTracker&&ErrorTracker.captureError(e,{context:"Shop",action:"applyFilters"})}}function r(){const t=document.getElementById("sort-select");t&&(t.value="default");const n=document.getElementById("price-filter");n&&(n.value="all");const o=document.getElementById("in-stock-filter");o&&(o.checked=!1);const i=document.getElementById("search-input");i&&(i.value="");const c=document.querySelector(".category-btn");c&&(document.querySelectorAll(".category-btn").forEach(e=>e.classList.remove("active")),c.classList.add("active")),e(groceries)}function d(e){try{const t=groceries.find(t=>t.id===e);if(!t)return;const n=document.getElementById("quick-view-modal");if(!n)return void("undefined"!=typeof showToast&&showToast("‚ö†Ô∏è Quick view not available on this page","error"));if(["qv-image","qv-name","qv-price","qv-category","qv-quantity","qv-add-btn"].filter(e=>!document.getElementById(e)).length>0)return void("undefined"!=typeof showToast&&showToast("‚ö†Ô∏è Quick view is not properly configured","error"));const o=t.imageUrl?`<img src="${t.imageUrl}" alt="${t.name}">`:t.emoji;document.getElementById("qv-image").innerHTML=o,document.getElementById("qv-name").textContent=t.name,document.getElementById("qv-price").textContent=`$${t.price.toFixed(2)}`,document.getElementById("qv-category").textContent=t.category,document.getElementById("qv-quantity").value=1,document.getElementById("qv-add-btn").onclick=()=>{const n=parseInt(document.getElementById("qv-quantity").value);for(let t=0;t<n;t++)addToCart(e);s(),"undefined"!=typeof showToast&&showToast(`‚úÖ Added ${n} ${t.name} to cart!`,"success")},n.classList.add("active"),document.body.style.overflow="hidden";const i=e=>{"Escape"===e.key&&(s(),document.removeEventListener("keydown",i))};document.addEventListener("keydown",i),n.onclick=e=>{e.target===n&&s()}}catch(t){"undefined"!=typeof ErrorTracker&&ErrorTracker.captureError(t,{context:"Shop",action:"openQuickView",itemId:e}),"undefined"!=typeof showToast&&showToast("‚ö†Ô∏è Unable to open quick view","error"),document.body.style.overflow="auto"}}function s(){const e=document.getElementById("quick-view-modal");e&&e.classList.remove("active"),document.body.style.overflow="auto"}function l(e){const t=document.getElementById("qv-quantity"),n=parseInt(t.value),o=Math.max(1,Math.min(99,n+e));t.value=o}let m;function u(){const e=document.getElementById("search-input");if(!e)return;const t=document.createElement("div");t.id="search-autocomplete",t.className="search-autocomplete",e.parentNode.style.position="relative",e.parentNode.appendChild(t),e.addEventListener("input",e=>{clearTimeout(m);const n=e.target.value.toLowerCase().trim();if(n.length<2)return t.innerHTML="",void(t.style.display="none");m=setTimeout(()=>{const e=groceries.filter(e=>e.name.toLowerCase().includes(n)||e.category.toLowerCase().includes(n)).slice(0,5);if(0===e.length)return t.innerHTML="",void(t.style.display="none");t.innerHTML=e.map(e=>{const t=e.imageUrl?`<img src="${e.imageUrl}" alt="${e.name}" style="width: 40px; height: 40px; object-fit: cover; border-radius: 8px;">`:`<span style="font-size: 32px;">${e.emoji}</span>`;return`\n                    <div class="autocomplete-item" onclick="selectSearchItem('${e.id}', '${e.name.replace(/'/g,"\\'")}')">\n                        <div class="autocomplete-image">${t}</div>\n                        <div class="autocomplete-details">\n                            <div class="autocomplete-name">${y(e.name,n)}</div>\n                            <div class="autocomplete-meta">${e.category} ‚Ä¢ $${e.price.toFixed(2)}</div>\n                        </div>\n                        <button class="autocomplete-add" onclick="event.stopPropagation(); addToCart('${e.id}'); closeAutocomplete();">+</button>\n                    </div>\n                `}).join(""),t.style.display="block"},300)}),document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||(t.style.display="none")})}function y(e,t){const n=new RegExp(`(${t})`,"gi");return e.replace(n,"<strong>$1</strong>")}function p(e,t){const n=document.getElementById("search-input");n&&(n.value=t,a(),g())}function g(){const e=document.getElementById("search-autocomplete");e&&(e.style.display="none")}document.addEventListener("DOMContentLoaded",function(){document.getElementById("grocery-grid")&&e(),document.getElementById("search-input")&&(0===groceries.length?setTimeout(()=>{groceries.length>0&&u()},1e3):u())}),window.renderGroceryGrid=e,window.renderCartItems=t,window.updateOrderSummary=n,window.filterCategory=o,window.searchItems=i,window.sortProducts=c,window.applyFilters=a,window.clearFilters=r,window.openQuickView=d,window.closeQuickView=s,window.adjustQvQuantity=l,window.setupSearchAutocomplete=u,window.selectSearchItem=p,window.closeAutocomplete=g;