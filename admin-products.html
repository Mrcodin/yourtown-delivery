<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - Admin Dashboard</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
    <link rel="stylesheet" href="loading.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body class="admin-body">
    <!-- SIDEBAR -->
    <aside class="admin-sidebar" id="admin-sidebar">
        <div class="sidebar-header">
            <h1 class="sidebar-logo">üõí Hometown</h1>
            <span class="sidebar-badge">Admin</span>
        </div>
        
        <nav class="sidebar-nav">
            <a href="admin.html" class="sidebar-link">
                <span class="sidebar-icon">üìä</span>
                Dashboard
            </a>
            <a href="admin-orders.html" class="sidebar-link">
                <span class="sidebar-icon">üì¶</span>
                Orders
            </a>
            <a href="admin-products.html" class="sidebar-link active">
                <span class="sidebar-icon">üõçÔ∏è</span>
                Products
            </a>
            <a href="admin-drivers.html" class="sidebar-link">
                <span class="sidebar-icon">üöó</span>
                Drivers
            </a>
            <a href="admin-customers.html" class="sidebar-link">
                <span class="sidebar-icon">üë•</span>
                Customers
            </a>
            <a href="admin-reports.html" class="sidebar-link">
                <span class="sidebar-icon">üìà</span>
                Reports
            </a>
            <a href="admin-email.html" class="sidebar-link">
                <span class="sidebar-icon">üìß</span>
                Email
            </a>
            <a href="admin-settings.html" class="sidebar-link">
                <span class="sidebar-icon">‚öôÔ∏è</span>
                Settings
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <a href="index.html" class="sidebar-link">
                <span class="sidebar-icon">üåê</span>
                View Website
            </a>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="admin-main">
        <header class="admin-topbar">
            <button class="mobile-sidebar-toggle" onclick="toggleAdminSidebar()">‚ò∞</button>
            <h2 class="topbar-title">Product Management</h2>
            <div class="topbar-right">
                <button class="btn btn-primary" onclick="openAddProductModal()">
                    ‚ûï Add Product
                </button>
            </div>
        </header>

        <div class="admin-content">
            <!-- FILTERS -->
            <div class="filters-bar">
                <div class="filter-group">
                    <label>Category:</label>
                    <select class="form-input" id="filter-category" onchange="filterProducts()">
                        <option value="all">All Categories</option>
                        <option value="bakery">üçû Bakery</option>
                        <option value="dairy">ü•õ Dairy & Eggs</option>
                        <option value="produce">ü•¨ Produce</option>
                        <option value="meat">ü•© Meat</option>
                        <option value="pantry">ü•´ Pantry</option>
                        <option value="frozen">üßä Frozen</option>
                        <option value="beverages">ü•§ Beverages</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Status:</label>
                    <select class="form-input" id="filter-product-status" onchange="filterProducts()">
                        <option value="all">All</option>
                        <option value="active">Active</option>
                        <option value="out-of-stock">Out of Stock</option>
                        <option value="hidden">Hidden</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label>Search:</label>
                    <input type="text" class="form-input" id="filter-product-search" placeholder="Search products..." onkeyup="filterProducts()">
                </div>
            </div>

            <!-- PRODUCT STATS -->
            <div class="order-stats">
                <div class="order-stat">
                    <span class="order-stat-count" id="count-total-products">0</span>
                    <span class="order-stat-label">Total Products</span>
                </div>
                <div class="order-stat delivered">
                    <span class="order-stat-count" id="count-active-products">0</span>
                    <span class="order-stat-label">Active</span>
                </div>
                <div class="order-stat new">
                    <span class="order-stat-count" id="count-out-of-stock">0</span>
                    <span class="order-stat-label">Out of Stock</span>
                </div>
            </div>

            <!-- PRODUCTS GRID -->
            <div class="products-admin-grid" id="products-grid">
                <!-- Populated by JavaScript -->
            </div>
        </div>
    </main>

    <!-- ADD/EDIT PRODUCT MODAL -->
    <div class="modal-overlay" id="product-modal">
        <div class="modal">
            <div class="modal-header">
                <h2 id="product-modal-title">Add New Product</h2>
                <button class="modal-close" onclick="closeModal('product-modal')">√ó</button>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <input type="hidden" id="product-id">
                    
                    <div class="form-group">
                        <label class="form-label">Product Name *</label>
                        <input type="text" class="form-input" id="product-name" required placeholder="e.g., Whole Milk (1 gallon)">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Price *</label>
                            <input type="number" class="form-input" id="product-price" step="0.01" min="0" required placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Category *</label>
                            <select class="form-input" id="product-category" required>
                                <option value="">Select category...</option>
                                <option value="bakery">üçû Bakery</option>
                                <option value="dairy">ü•õ Dairy & Eggs</option>
                                <option value="produce">ü•¨ Produce</option>
                                <option value="meat">ü•© Meat</option>
                                <option value="pantry">ü•´ Pantry</option>
                                <option value="frozen">üßä Frozen</option>
                                <option value="beverages">ü•§ Beverages</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Emoji Icon</label>
                            <input type="text" class="form-input" id="product-emoji" placeholder="ü•õ">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-input" id="product-status">
                                <option value="active">Active</option>
                                <option value="out-of-stock">Out of Stock</option>
                                <option value="hidden">Hidden</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Product Image</label>
                        <div style="display: flex; gap: 15px; align-items: flex-start;">
                            <div style="flex: 1;">
                                <input type="file" class="form-input" id="product-image-file" accept="image/*" onchange="previewProductImage(event)" style="padding: 8px;">
                                <small style="display: block; margin-top: 5px; color: #666; font-size: 13px;">
                                    Upload JPEG, PNG, or WebP (max 5MB). Images will be optimized automatically.
                                </small>
                            </div>
                            <div id="image-preview-container" style="display: none; position: relative;">
                                <img id="image-preview" src="" alt="Preview" style="width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb;">
                                <button type="button" onclick="clearImagePreview()" style="position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer; font-size: 16px; line-height: 1;">√ó</button>
                            </div>
                        </div>
                        <div id="current-image-container" style="display: none; margin-top: 10px;">
                            <small style="color: #666;">Current image:</small>
                            <img id="current-image" src="" alt="Current" style="display: block; width: 120px; height: 120px; object-fit: cover; border-radius: 8px; border: 2px solid #e5e7eb; margin-top: 5px;">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Description (optional)</label>
                        <textarea class="form-input form-textarea" id="product-description" placeholder="Product description..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal('product-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveProduct()">Save Product</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="api.js"></script>
    <script src="auth.js"></script>
    <script src="main.js"></script>    <script src="loading.js"></script>    <script src="admin.js"></script>

    <script>
        let selectedImageFile = null;

        function previewProductImage(event) {
            const file = event.target.files[0];
            if (file) {
                selectedImageFile = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('image-preview').src = e.target.result;
                    document.getElementById('image-preview-container').style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        function clearImagePreview() {
            selectedImageFile = null;
            document.getElementById('product-image-file').value = '';
            document.getElementById('image-preview').src = '';
            document.getElementById('image-preview-container').style.display = 'none';
        }

        async function uploadProductImage(productId) {
            if (!selectedImageFile) return null;

            const formData = new FormData();
            formData.append('image', selectedImageFile);

            try {
                const response = await fetch(`${API_BASE_URL}/api/products/${productId}/image`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: formData
                });

                const data = await response.json();
                if (data.success) {
                    return data.imageUrl;
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                throw error;
            }
        }

        function showCurrentImage(imageUrl) {
            if (imageUrl) {
                document.getElementById('current-image').src = imageUrl;
                document.getElementById('current-image-container').style.display = 'block';
            } else {
                document.getElementById('current-image-container').style.display = 'none';
            }
        }

        function resetImageFields() {
            clearImagePreview();
            document.getElementById('current-image-container').style.display = 'none';
        }
    </script>
</body>
</html>
