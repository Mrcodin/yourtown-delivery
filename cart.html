<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Cart - Hometown Delivery</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="loading.css">
    <link rel="stylesheet" href="breadcrumb.css">
    <link rel="stylesheet" href="toast.css">
    <link rel="stylesheet" href="back-to-top.css">
    <link rel="stylesheet" href="card-hover.css">
    <link rel="stylesheet" href="form-validation.css">
    <link rel="stylesheet" href="mobile-touch.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <script src="toast.js"></script>
    <!-- ACCESSIBILITY TOOLBAR -->
    <div class="accessibility-bar">
        <div class="container accessibility-container">
            <span>Accessibility:</span>
            <button onclick="toggleLargeText()" id="text-size-btn" class="access-btn">üî§ Larger Text</button>
            <button onclick="toggleContrast()" id="contrast-btn" class="access-btn">üåì High Contrast</button>
            <button onclick="speakPage()" id="speak-btn" class="access-btn">üîä Read Aloud</button>
        </div>
    </div>

    <!-- PHONE BAR -->
    <div class="phone-bar">
        <div class="container">
            üìû Questions about your order? Call <a href="tel:555-123-4567">555-123-4567</a>
        </div>
    </div>

    <!-- HEADER -->
    <header class="header">
        <div class="container header-container">
            <a href="index.html" class="logo">
                <span class="logo-icon">üõí</span>
                <span class="logo-text">Hometown Delivery</span>
            </a>
            <nav class="nav" id="main-nav">
                <a href="index.html" class="nav-link">Home</a>
                <a href="shop.html" class="nav-link">Shop Groceries</a>
                <a href="cart.html" class="nav-link active">
                    üõí Cart (<span id="cart-count">0</span>)
                </a>
                <a href="track.html" class="nav-link">Track Order</a>
                <span id="customer-nav"></span>
            </nav>
        </div>
    </header>

    <!-- BREADCRUMB -->
    <div class="container">
        <div id="breadcrumb-container"></div>
    </div>

    <!-- MAIN CONTENT -->
    <main class="main-content">
        <div class="container">
            <h1 class="page-title">Your Shopping Cart</h1>

            <!-- CART LAYOUT -->
            <div class="cart-layout">
                <!-- CART ITEMS -->
                <div class="cart-items-container">
                    <div id="cart-items">
                        <!-- Items loaded by JavaScript -->
                    </div>
                    
                    <!-- EMPTY CART STATE -->
                    <div class="empty-cart" id="empty-cart">
                        <div class="empty-icon">üõí</div>
                        <h3>Your cart is empty</h3>
                        <p>Add some groceries to get started!</p>
                        <a href="shop.html" class="btn btn-primary btn-lg">Start Shopping</a>
                    </div>

                    <!-- CONTINUE SHOPPING -->
                    <div class="cart-actions" id="cart-actions" style="display: none;">
                        <a href="shop.html" class="btn btn-outline">‚Üê Continue Shopping</a>
                        <button onclick="clearCart()" class="btn btn-outline btn-danger">üóëÔ∏è Clear Cart</button>
                    </div>
                </div>

                <!-- ORDER SUMMARY -->
                <div class="order-summary" id="order-summary" style="display: none;">
                    <div class="summary-card">
                        <h2 class="summary-title">Order Summary</h2>
                        
                        <div class="summary-row">
                            <span>Items (<span id="summary-item-count">0</span>)</span>
                            <span>$<span id="summary-subtotal">0.00</span></span>
                        </div>
                        
                        <div class="summary-row">
                            <span>Delivery Fee</span>
                            <span>$<span id="summary-delivery">6.99</span></span>
                        </div>
                        
                        <div class="summary-row summary-total">
                            <span>Total</span>
                            <span>$<span id="summary-total">0.00</span></span>
                        </div>

                        <hr class="summary-divider">

                        <!-- DELIVERY INFO FORM -->
                        <h3 class="form-section-title">üìç Delivery Information</h3>
                        
                        <!-- Saved Addresses Selection (for logged-in customers) -->
                        <div id="saved-addresses-section" style="display: none; margin-bottom: 20px;">
                            <div class="form-group">
                                <label for="saved-address-select" class="form-label">Use a Saved Address</label>
                                <select id="saved-address-select" class="form-input form-select">
                                    <option value="">-- Enter new address --</option>
                                </select>
                            </div>
                        </div>
                        
                        <form id="checkout-form">
                            <div class="form-group">
                                <label for="name" class="form-label">Full Name *</label>
                                <input 
                                    type="text" 
                                    id="name" 
                                    class="form-input" 
                                    placeholder="John Smith"
                                    required
                                >
                            </div>
                            
                            <div class="form-group">
                                <label for="phone" class="form-label">Phone Number *</label>
                                <input 
                                    type="tel" 
                                    id="phone" 
                                    class="form-input" 
                                    placeholder="555-123-4567"
                                    required
                                >
                                <small class="form-help">We'll call to confirm your order</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="address" class="form-label">Delivery Address *</label>
                                <textarea 
                                    id="address" 
                                    class="form-input form-textarea" 
                                    placeholder="123 Main St, Apt 4B"
                                    required
                                ></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label for="email" class="form-label">Email (optional)</label>
                                <input 
                                    type="email" 
                                    id="email" 
                                    class="form-input" 
                                    placeholder="john@email.com"
                                >
                            </div>
                            
                            <div class="form-group">
                                <label for="delivery-time" class="form-label">Preferred Delivery Time</label>
                                <select id="delivery-time" class="form-input form-select">
                                    <option value="asap">As Soon As Possible</option>
                                    <option value="morning">Morning (9am - 12pm)</option>
                                    <option value="afternoon">Afternoon (12pm - 4pm)</option>
                                    <option value="evening">Evening (4pm - 7pm)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="notes" class="form-label">Special Instructions</label>
                                <textarea 
                                    id="notes" 
                                    class="form-input form-textarea" 
                                    placeholder="Ring doorbell, leave on porch, etc."
                                ></textarea>
                            </div>

                            <h3 class="form-section-title">üí≥ Payment Method</h3>
                            
                            <div class="payment-options">
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="cash" checked>
                                    <div class="payment-content">
                                        <span class="payment-icon">üíµ</span>
                                        <div>
                                            <strong>Cash on Delivery</strong>
                                            <small>Pay your driver when they arrive</small>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="check">
                                    <div class="payment-content">
                                        <span class="payment-icon">üìù</span>
                                        <div>
                                            <strong>Check</strong>
                                            <small>Make payable to "Hometown Delivery"</small>
                                        </div>
                                    </div>
                                </label>
                                
                                <label class="payment-option">
                                    <input type="radio" name="payment" value="card">
                                    <div class="payment-content">
                                        <span class="payment-icon">üí≥</span>
                                        <div>
                                            <strong>Credit/Debit Card</strong>
                                            <small>Secure online payment</small>
                                        </div>
                                    </div>
                                </label>
                            </div>

                            <!-- Progress Indicator (shown during checkout) -->
                            <div id="checkout-progress" style="margin: 30px 0;"></div>

                            <button type="submit" class="btn btn-primary btn-xl btn-block">
                                <span class="btn-text">üöö Place Order</span>
                            </button>
                            
                            <p class="form-note">
                                We'll call you within 30 minutes to confirm your order
                            </p>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer class="footer footer-simple">
        <div class="container">
            <p>&copy; 2024 Hometown Grocery Delivery | üìû <a href="tel:555-123-4567">555-123-4567</a></p>
        </div>
    </footer>

    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script src="api.js"></script>
    <script src="customer-auth.js"></script>
    <script src="loading.js"></script>
    <script src="breadcrumb.js"></script>
    <script src="config.js"></script>
    <script src="page-config.js"></script>
    <script src="main.js"></script>
    <script>
        // Update navigation
        function updateCustomerNav() {
            const navSpan = document.getElementById('customer-nav');
            if (customerAuth.isLoggedIn()) {
                navSpan.innerHTML = '<a href="customer-account.html" class="nav-link">üë§ My Account</a>';
                loadSavedAddresses();
            } else {
                navSpan.innerHTML = '<a href="customer-login.html" class="nav-link">Login</a>';
            }
        }
        updateCustomerNav();

        // Load saved addresses for logged-in customers
        async function loadSavedAddresses() {
            try {
                const customer = await customerAuth.getProfile();
                
                if (customer && customer.addresses && customer.addresses.length > 0) {
                    const section = document.getElementById('saved-addresses-section');
                    const select = document.getElementById('saved-address-select');
                    
                    // Show the saved addresses section
                    section.style.display = 'block';
                    
                    // Pre-fill name fields with customer info
                    document.getElementById('name').value = customer.name;
                    document.getElementById('phone').value = customer.phone;
                    document.getElementById('email').value = customer.email;
                    
                    // Add addresses to dropdown
                    customer.addresses.forEach((addr, index) => {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${addr.label || 'Address'} - ${addr.street}, ${addr.city}`;
                        select.appendChild(option);
                    });
                    
                    // Handle address selection
                    select.addEventListener('change', (e) => {
                        const selectedIndex = e.target.value;
                        
                        if (selectedIndex === '') {
                            // Clear address field for new entry
                            document.getElementById('address').value = '';
                        } else {
                            const addr = customer.addresses[selectedIndex];
                            const fullAddress = `${addr.street}\n${addr.city}, ${addr.state} ${addr.zipCode}${addr.instructions ? '\n\nInstructions: ' + addr.instructions : ''}`;
                            document.getElementById('address').value = fullAddress;
                        }
                    });
                }
            } catch (error) {
                console.log('Not logged in or unable to load addresses');
            }
        }
    </script>
    <script src="back-to-top.js"></script>
</body>
</html>
