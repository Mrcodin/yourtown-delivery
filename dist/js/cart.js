let e=[];function t(){const t=localStorage.getItem("hometownCart");if(t)try{e=JSON.parse(t)}catch(t){"undefined"!=typeof ErrorTracker&&ErrorTracker.captureError(t,{context:"Cart Loading",action:"loadCart"}),e=[]}a()}function r(){try{localStorage.setItem("hometownCart",JSON.stringify(e)),a()}catch(e){"undefined"!=typeof ErrorTracker&&ErrorTracker.captureError(e,{context:"Cart Saving",action:"saveCart"})}}function a(){const t=document.querySelectorAll("#cart-count"),r=e.reduce((e,t)=>e+t.quantity,0);t.forEach(e=>e.textContent=r),n(),document.getElementById("cart-items")&&renderCartItems()}function n(){const t=document.getElementById("cart-preview");if(!t)return;const r=e.reduce((e,t)=>e+t.quantity,0),a=e.reduce((e,t)=>e+t.price*t.quantity,0);if(r>0){t.classList.add("active");const e=document.getElementById("preview-count"),n=document.getElementById("preview-total");e&&(e.textContent=r),n&&(n.textContent=a.toFixed(2))}else t.classList.remove("active")}function o(t){const a=groceries.find(e=>e.id===t);if(!a)return;const n=e.find(e=>e.id===t);n?n.quantity+=1:e.push({id:a.id,name:a.name,price:a.price,emoji:a.emoji,imageUrl:a.imageUrl,quantity:1,isTaxable:a.isTaxable||!1}),r(),showToast(`✅ ${a.name} added to cart!`,"success")}function i(t){e=e.filter(e=>e.id!==t),r()}function c(t,a){const n=e.find(e=>e.id===t);n&&(n.quantity+=a,n.quantity<=0?i(t):r())}function d(){confirm("Are you sure you want to clear your cart?")&&(e=[],r(),showToast("Cart cleared","success"))}function u(){"undefined"!=typeof USUAL_ORDER_IDS&&0!==USUAL_ORDER_IDS.length?(USUAL_ORDER_IDS.forEach(t=>{const r=groceries.find(e=>e.id===t);r&&(e.find(e=>e.id===t)||e.push({id:r.id,name:r.name,price:r.price,emoji:r.emoji,imageUrl:r.imageUrl,quantity:1,isTaxable:r.isTaxable||!1}))}),r(),showToast("✅ Your usual order has been loaded!","success")):showToast("No usual order available","info")}function s(){return e.reduce((e,t)=>e+t.price*t.quantity,0)}function l(){return e.reduce((e,t)=>e+t.quantity,0)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),"undefined"!=typeof module&&module.exports&&(module.exports={cart:e,loadCart:t,saveCart:r,addToCart:o,removeFromCart:i,updateQuantity:c,clearCart:d,loadUsualOrder:u,getCartTotal:s,getCartItemCount:l});